# Self-RAG (Self-Reflective Retrieval-Augmented Generation) 가이드

`Self-RAG`는 전통적인 RAG 구조에 **자기반영(Self-Reflection)** 과정을 결합하여, **생성된 응답의 품질을 스스로 평가하고 개선하기 위해 재검색, 재생성 루프를 수행하는 고급 RAG 형태**입니다. Meta AI의 연구 논문 "Self-RAG: Faithful and Customizable Retrieval-Augmented Generation"에서 제안된 방식으로, 응답의 신뢰성과 사용자 요구 적합도를 높이는 데 초점을 둡니다.

---

## ✅ Self-RAG란?

| 항목      | 설명                                                                                |
| --------- | ----------------------------------------------------------------------------------- |
| 정의      | RAG 구조에 **자기 평가(self-evaluation)** 및 **재검색/재생성 루프**를 포함시킨 구조 |
| 목적      | 잘못된 추론, 부족한 정보, 비사실적 답변을 방지하고 응답의 **신뢰성과 정확성 향상**  |
| 핵심 요소 | LLM 기반 평가기(evaluator) + 조건부 루프 기반 재검색 및 재생성                      |

---

## 🔁 동작 흐름 요약

```
[사용자 질문] → [Retriever] → [LLM 생성] → [LLM 평가] →
   → [문제 없음 → 응답 확정]
   → [문제 있음 → 재검색 + 재생성 반복]
```

---

## 🔍 Self-RAG 핵심 구성 요소

### 1. **Evaluator (평가기)**

- LLM이 스스로 생성한 응답에 대해 평가 수행
- 평가 기준 예시:

  - 응답이 질문에 충분한가?
  - 출처가 정확하고 타당한가?
  - 사용자 의도에 맞는가?

### 2. **Reflection-based Feedback Loop**

- 평가 결과가 미흡할 경우:

  - 더 많은 문서를 검색하거나
  - 새로운 질의어(query)를 구성하거나
  - 추가 reasoning을 요청하여 재생성

### 3. **Customizable Evaluation Criteria**

- 도메인에 따라 평가 기준을 조절 가능
- 예: 의료 응답 → 과학적 정확성 중심 / 제품 안내 → 친절성 중심

---

## 🧠 LangGraph / LangChain 기반 구현 예시 구조

| 노드      | 설명                                       |
| --------- | ------------------------------------------ |
| Retriever | 초기 문서 검색 수행                        |
| Generator | 문서를 기반으로 응답 생성                  |
| Evaluator | LLM이 응답을 평가함 (신뢰도, 정확도 등)    |
| Reflector | 조건부 분기로 재검색 여부 판단 → 루프 발생 |

```text
START → Retriever → Generator → Evaluator
      → [좋음] → END
      → [부족] → Retriever (다시 반복)
```

- LangGraph에서는 조건부 edge와 반복 루프를 쉽게 구성 가능

---

## 📌 Self-RAG의 장점

| 항목               | 설명                                        |
| ------------------ | ------------------------------------------- |
| 응답의 신뢰성 향상 | hallucination 감소 및 불충분 응답 보완      |
| 사용자 의도 반영   | 커스터마이징된 평가 기준에 따른 적합성 향상 |
| 도메인 적응        | 도메인별 정확도 요구 수준 반영 가능         |

---

## ❗ 고려사항 및 한계

| 항목         | 설명                                               |
| ------------ | -------------------------------------------------- |
| 비용 증가    | LLM 평가 및 재생성 루프로 인해 호출 횟수 증가      |
| latency 증가 | 실시간 응답 시스템에서는 지연 발생 가능성 있음     |
| 평가 편향    | LLM이 응답을 잘못 평가하거나, 과도하게 반복할 위험 |

---

`Self-RAG`는 단순히 문서를 가져와 답을 생성하는 RAG에서 벗어나, **“내가 한 말을 내가 다시 검토하고 보완하는” LLM의 자기 피드백 기반 시스템**입니다. LangGraph의 조건부 노드와 반복 루프 기능을 활용하면 이를 안정적으로 구현할 수 있습니다.
