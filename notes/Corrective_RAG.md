# Corrective RAG (Retrieval-Augmented Generation with Correction) 가이드

`Corrective RAG`는 기본적인 RAG 시스템에서 발생할 수 있는 **hallucination, 불완전한 정보, 비사실적 응답** 등의 문제를 **사후 교정(correction) 단계**를 통해 보완하는 방식입니다. 이는 LLM이 생성한 응답을 다시 평가 및 수정하는 후처리 기반의 RAG 확장 전략으로, Self-RAG와 구조적으로 유사하지만 \*\*명시적인 교정기(corrector)\*\*를 강조합니다.

---

## ✅ Corrective RAG란?

| 항목      | 설명                                                                               |
| --------- | ---------------------------------------------------------------------------------- |
| 정의      | RAG의 응답 생성 이후 **별도의 LLM 또는 평가 모델이 응답을 검토하고 교정**하는 구조 |
| 목적      | 부정확하거나 과장된 응답에 대한 자동 보정 및 신뢰도 향상                           |
| 구성 방식 | Generator → Evaluator → Corrector 흐름으로 분리됨                                  |

---

## 🔁 동작 흐름 예시

```text
질문 → Retriever → Generator → Evaluator → Corrector → 응답 출력
```

- **Evaluator**: 생성된 응답을 기준에 따라 진단
- **Corrector**: 평가 결과를 바탕으로 재구성 또는 부분 교정 수행

---

## 🧠 핵심 구성 요소

### 1. Generator

- 초기 응답 생성 (기존 RAG 구조와 동일)

### 2. Evaluator

- LLM 또는 룰 기반 평가기
- 판단 기준 예시: 정보 불충분, 허위, 논리 오류 등

### 3. Corrector

- 문제가 있는 부분을 보완하거나 완전히 다시 작성
- 예: "이 응답은 X가 부족합니다. 문서를 기반으로 X를 추가하세요."

---

## ⚙️ LangGraph로 구현 예시

| 노드     | 설명                       |
| -------- | -------------------------- |
| retrieve | 문서 검색기                |
| generate | LLM 기반 응답 생성         |
| evaluate | 응답 평가 (문제 여부 판단) |
| correct  | 문제 시 수정 실행          |

```text
START → retrieve → generate → evaluate
         → [양호] → END
         → [문제] → correct → END
```

- `evaluate` 노드는 `ToolMessage` 또는 Boolean 값을 반환할 수 있음
- 조건부 분기로 `correct` 노드를 실행할지 여부 결정

---

## 🔍 Self-RAG과의 차이점

| 항목        | Self-RAG                      | Corrective RAG               |
| ----------- | ----------------------------- | ---------------------------- |
| 루프 여부   | 반복 구조 있음 (재검색 가능)  | 단일 평가 → 단일 교정        |
| 평가 목적   | 재검색 여부 판단              | 수정 필요성 판단             |
| 구조 복잡도 | 높음 (루프 및 반복 평가 포함) | 비교적 단순 (후처리 위주)    |
| 적용 시점   | 생성 중간 또는 이후           | 생성 후 전용 교정기로 후처리 |

---

## 📌 사용 시 장점

| 장점               | 설명                                            |
| ------------------ | ----------------------------------------------- |
| 신뢰도 향상        | 사용자에게 더 정제된 결과 제공 가능             |
| 정보 누락 보완     | 중요한 문서 정보가 빠진 경우 후처리로 보완 가능 |
| 다단계 컨트롤 가능 | 평가-보정 체계를 분리하여 각 역할을 명확히 구성 |

---

## ⚠️ 고려사항

| 항목           | 내용                                         |
| -------------- | -------------------------------------------- |
| 비용 증가      | 평가 + 보정에 추가 LLM 호출 필요             |
| 평가 편향      | LLM 평가기의 오류가 수정에도 영향            |
| 확신 없는 결과 | 교정이 부정확하면 더 왜곡된 결과가 나올 위험 |

---

`Corrective RAG`는 초기 RAG 응답의 한계를 교정기(corrector)를 통해 보완함으로써, **정확하고 신뢰도 높은 응답을 제공하는 후처리 중심의 전략**입니다. Self-RAG의 반복 루프 방식보다 더 단순하게 적용할 수 있으면서도, 사용자 신뢰를 확보하는 데 효과적인 방법입니다.
