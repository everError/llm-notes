# Adaptive RAG (Retrieval-Augmented Generation) 가이드

`Adaptive RAG`는 전통적인 RAG(Retrieval-Augmented Generation) 방식에서 한 단계 진화한 형태로, **질문에 따라 검색 전략 또는 생성 방식이 동적으로 조정되는 RAG 구조**입니다. 이는 단순히 고정된 retriever + generator 조합을 넘어서, 상황에 따라 검색 범위, 문서 수, 요약 방식, 생성 전략 등을 바꿔가며 더 유연하고 정확한 응답을 생성할 수 있게 합니다.

---

## ✅ 기본 RAG 구조 복습

```
[질문] → [Retriever] → 관련 문서 N개 → [LLM Generator] → [응답 생성]
```

- Retriever: 벡터 검색, BM25 등으로 관련 문서 선택
- Generator: LLM이 선택된 문서를 기반으로 답변 생성
- 문제점: 모든 질문에 동일한 검색량, 동일한 방식 적용 → 효율성, 정확도 한계

---

## 🤖 Adaptive RAG란?

| 항목      | 설명                                                                      |
| --------- | ------------------------------------------------------------------------- |
| 정의      | 질문이나 상황에 따라 검색 또는 생성 전략을 **동적으로 조정**하는 RAG 구조 |
| 목표      | 더 적은 리소스로 더 정확하고 응답력 높은 결과 생성                        |
| 활용 방식 | 조건부 라우팅, 평가 기반 재검색, 다단계 요약 등                           |

### 📌 예시 시나리오

| 질문 유형   | 적응형 처리 방식                                      |
| ----------- | ----------------------------------------------------- |
| 단순 질문   | retriever 생략하거나 검색 문서 수 축소 (e.g., 1\~2개) |
| 복잡 질문   | 다단계 검색 + 요약 + 추론 체계 적용                   |
| 특정 도메인 | 해당 도메인 retriever 또는 프롬프트로 분기            |

---

## ⚙️ 주요 구성 전략

### 1. **조건부 라우팅 (Routing)**

- 질문을 먼저 분석 → 단순/복잡/계산/정의형 등으로 분류
- 각 유형별로 다른 retriever 또는 generator 실행

### 2. **Adaptive Retriever**

- 검색 문서 수, 유사도 기준, 벡터/키워드 방식 등을 질문별로 조절
- `query classifier` 또는 `score-based reranking`과 함께 사용

### 3. **Self-refinement / Reflection**

- 1차 생성 결과를 다시 LLM이 평가 → 검색 범위 확대 or 재검색
- 예: "너무 모호한 답변입니다" → 더 많은 문서로 재시도

### 4. **Multi-hop + Summarization**

- 질문이 복잡한 경우: 관련 문서를 여러 단계로 나눠 요약 + 병합 → 최종 생성

---

## 🔁 LangChain/LangGraph에서 구현 시 요소

| 구성 요소          | 설명                                                         |
| ------------------ | ------------------------------------------------------------ |
| 질문 분류기        | `RunnableBranch`, `Router`, 또는 custom classifier 노드 사용 |
| Adaptive Retriever | 검색량, 전략을 파라미터로 조정 가능한 retriever 정의         |
| Summarizer         | 필요시 문서 요약 또는 압축 단계 삽입                         |
| Reflection Node    | 생성 결과 평가 후 반복 여부 결정                             |
| 상태 추적          | LangGraph의 상태(key-value)로 동적 전략 조합 가능            |

---

## 💡 이점 및 활용 분야

| 항목             | 설명                                                     |
| ---------------- | -------------------------------------------------------- |
| 효율성 향상      | 쉬운 질문에는 빠르게, 어려운 질문은 정밀하게 대응        |
| 비용 절감        | LLM 호출 횟수, context 길이 절감 가능                    |
| 사용자 경험 향상 | 질문 유형에 따라 응답 품질 최적화                        |
| 적용 사례        | 고객지원, 법률 문서 QA, 의료 검색, 멀티도메인 지식 QA 등 |

---

## 📌 참고 개념

- **RAG Fusion**: 여러 검색 결과를 평균화하여 다각도 응답 생성
- **ReAct + RAG**: 도구 기반 추론 흐름과 결합하여 동적 reasoning + retrieval 적용
- **Meta Adaptive RAG 논문**: 조건부 검색 및 생성 전략 조정 방식 연구

---

Adaptive RAG는 고정된 검색/생성 파이프라인을 넘어서, 질문의 의미를 더 잘 파악하고 이에 맞는 전략을 유연하게 적용할 수 있는 진화된 형태의 RAG입니다. LangGraph나 LangChain을 활용하면 복잡한 분기, 상태 추적, 반복 루프 등을 통해 이를 실제로 구현할 수 있습니다.
