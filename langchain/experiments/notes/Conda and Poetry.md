# Conda와 Poetry를 함께 사용하기 위한 가이드

## 1\. 개요

이 문서는 **Conda**와 **Poetry**를 함께 사용하여 파이썬 프로젝트의 환경을 관리하는 워크플로우를 설명합니다. 이 조합은 Conda의 강력한 **파이썬 인터프리터 및 바이너리 패키지 관리** 능력과 Poetry의 현대적인 **프로젝트 의존성 관리 및 패키징** 기능을 결합하여, 복잡한 프로젝트에서도 안정적이고 재현 가능한 개발 환경을 구축하는 것을 목표로 합니다.

---

## 2\. 왜 이 조합을 사용하는가?

두 도구는 각자 다른 문제에 집중하며, 이를 결합하면 시너지를 낼 수 있습니다.

### 역할 분담

- **Conda의 역할: 시스템 레벨 관리**

  - **파이썬 인터프리터 관리**: 프로젝트별로 `Python 3.9`, `Python 3.10` 등 특정 버전의 파이썬을 손쉽게 설치하고 격리합니다.
  - **비(非)파이썬 의존성 관리**: `CUDA`, `cuDNN`, `GDAL`, `MKL` 등 컴파일이 필요하거나 시스템에 종속적인 복잡한 바이너리 라이브러리를 안정적으로 관리합니다. 이는 데이터 과학 및 머신러닝 분야에서 특히 중요합니다.

- **Poetry의 역할: 프로젝트 레벨 관리**

  - **파이썬 패키지 의존성 관리**: `pyproject.toml` 파일을 통해 프로젝트가 사용하는 파이썬 라이브러리(`requests`, `pandas` 등)를 명시적으로 관리합니다.
  - **재현성 보장**: `poetry.lock` 파일을 생성하여 모든 의존성 패키지의 버전을 고정시킴으로써, 다른 환경에서도 100% 동일한 환경을 재구성할 수 있도록 보장합니다.
  - **빌드 및 배포**: 프로젝트를 손쉽게 빌드하고 PyPI(Python Package Index) 등에 배포할 수 있는 기능을 제공합니다.

### 장점

- **안정성**: Conda가 복잡한 시스템 레벨 의존성을 처리해 주므로 "설치 실패" 문제를 최소화할 수 있습니다.
- **명확성**: Poetry가 파이썬 패키지 의존성을 `pyproject.toml` 안에서 깔끔하게 관리하므로 프로젝트 구조가 명확해집니다.
- **통합된 환경**: Poetry가 별도의 가상 환경을 만들지 않고 Conda가 생성한 환경을 그대로 사용하도록 설정하여, 환경 관리가 중복되지 않고 단순해집니다.

---

## 3\. 단계별 워크플로우

### 1단계: Conda로 기본 환경 생성

먼저 프로젝트의 기반이 될 Conda 가상 환경을 생성합니다. 이 환경은 사용할 파이썬 버전을 지정하는 역할을 합니다.

```bash
# "my-project"라는 이름으로 Python 3.10 버전의 환경을 생성합니다.
conda create --name my-project python=3.10

# 생성된 환경을 활성화합니다.
conda activate my-project
```

이제 터미널 프롬프트 앞에 `(my-project)`가 표시되며, 이 환경 안에서 모든 작업이 이루어집니다.

### 2단계: 활성화된 환경에 Poetry 설치

전역(Global)이 아닌, 현재 활성화된 Conda 환경 내부에 `pip`를 이용해 Poetry를 설치합니다.

```bash
# (my-project) 환경이 활성화된 상태에서 실행합니다.
pip install poetry
```

### 3단계: Poetry 설정 변경

**가장 중요한 단계입니다.** Poetry가 새로운 가상 환경을 만들지 않고, 현재 Conda 환경을 그대로 사용하도록 설정해야 합니다.

```bash
# (my-project)
# Poetry가 가상 환경을 생성하지 않도록 현재 프로젝트에만 로컬 설정을 적용합니다.
poetry config virtualenvs.create false --local
```

- `--local` 플래그는 이 설정을 현재 디렉터리(`my-project`)에만 적용합니다. 따라서 다른 프로젝트의 Poetry 동작에는 영향을 주지 않습니다.

### 4단계: Poetry 프로젝트 초기화 및 의존성 관리

이제 프로젝트를 시작하고 Poetry를 사용하여 파이썬 패키지를 관리할 수 있습니다.

```bash
# (my-project)
# 현재 디렉터리에 pyproject.toml 파일을 생성합니다.
poetry init

# 프로젝트에 필요한 패키지를 추가합니다.
# 예: pandas와 requests 라이브러리 추가
poetry add pandas requests

# pyproject.toml에 명시된 모든 패키지를 설치합니다.
# 다른 환경에서 프로젝트를 설정할 때 이 명령어를 사용합니다.
poetry install
```

이 과정이 끝나면 모든 패키지는 Conda가 생성한 `my-project` 환경 내 site-packages 폴더에 설치됩니다. `poetry.lock` 파일은 프로젝트 루트에 생성되어 정확한 패키지 버전을 기록합니다.

---

## 4\. 요약

1.  \*\*`conda create`\*\*로 파이썬 버전이 지정된 기본 환경을 만든다.
2.  \*\*`conda activate`\*\*로 환경을 활성화한다.
3.  활성화된 환경 안에서 \*\*`pip install poetry`\*\*로 Poetry를 설치한다.
4.  **`poetry config virtualenvs.create false --local`** 명령어로 Poetry가 현재 Conda 환경을 사용하도록 설정한다.
5.  이후 모든 파이썬 패키지 관리는 **`poetry add`**, **`poetry install`** 등 Poetry 명령어로 수행한다.

이 워크플로우를 통해 각 도구의 장점을 최대한 활용하여 깨끗하고 안정적인 파이썬 프로젝트 개발 환경을 구축할 수 있습니다.
